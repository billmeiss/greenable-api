=LET(
  current_revenue, F10,
  current_employees, H10,
  current_category, AE10,
  current_scope1, J10,
  current_scope2_location, K10,
  current_scope2_market, L10,
  current_scope3_cat1, N10,
  current_scope3_cat2, O10,
  current_scope3_cat3, P10,
  current_scope3_cat4, Q10,
  current_scope3_cat5, R10,
  current_scope3_cat6, S10,
  current_scope3_cat7, T10,
  current_scope3_cat8, U10,
  
  revenue_band, IF(current_revenue <= 50000000, "0-50M", 
                IF(current_revenue <= 250000000, "50M-250M", 
                IF(current_revenue <= 1000000000, "250M-1B", "1B+"))),
  
  employee_band, IF(current_employees <= 100, "1-100", 
                 IF(current_employees <= 500, "101-500", 
                 IF(current_employees <= 2000, "501-2000", "2001+"))),
  
  industry, current_category,
  
  has_valid_employees, AND(NOT(ISBLANK(current_employees)), ISNUMBER(current_employees), current_employees > 0),
  
  specific_match_D, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!D:D, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_D, INDEX(Industry_Averages!D:D, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope1, IF(ISNUMBER(specific_match_D), specific_match_D, IF(ISNUMBER(fallback_match_D), fallback_match_D, "")),
  
  specific_match_E, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!E:E, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_E, INDEX(Industry_Averages!E:E, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope2, IF(ISNUMBER(specific_match_E), specific_match_E, IF(ISNUMBER(fallback_match_E), fallback_match_E, "")),
  
  specific_match_F, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!F:F, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_F, INDEX(Industry_Averages!F:F, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat1, IF(ISNUMBER(specific_match_F), specific_match_F, IF(ISNUMBER(fallback_match_F), fallback_match_F, "")),
  
  specific_match_G, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!G:G, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_G, INDEX(Industry_Averages!G:G, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat2, IF(ISNUMBER(specific_match_G), specific_match_G, IF(ISNUMBER(fallback_match_G), fallback_match_G, "")),
  
  specific_match_H, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!H:H, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_H, INDEX(Industry_Averages!H:H, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat3, IF(ISNUMBER(specific_match_H), specific_match_H, IF(ISNUMBER(fallback_match_H), fallback_match_H, "")),
  
  specific_match_I, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!I:I, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_I, INDEX(Industry_Averages!I:I, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat4, IF(ISNUMBER(specific_match_I), specific_match_I, IF(ISNUMBER(fallback_match_I), fallback_match_I, "")),
  
  specific_match_J, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!J:J, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_J, INDEX(Industry_Averages!J:J, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat5, IF(ISNUMBER(specific_match_J), specific_match_J, IF(ISNUMBER(fallback_match_J), fallback_match_J, "")),
  
  specific_match_K, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!K:K, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_K, INDEX(Industry_Averages!K:K, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat6, IF(ISNUMBER(specific_match_K), specific_match_K, IF(ISNUMBER(fallback_match_K), fallback_match_K, "")),
  
  specific_match_L, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!L:L, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_L, INDEX(Industry_Averages!L:L, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat7, IF(ISNUMBER(specific_match_L), specific_match_L, IF(ISNUMBER(fallback_match_L), fallback_match_L, "")),
  
  specific_match_M, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!M:M, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_M, INDEX(Industry_Averages!M:M, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat8, IF(ISNUMBER(specific_match_M), specific_match_M, IF(ISNUMBER(fallback_match_M), fallback_match_M, "")),
  
  office_based_category, OR(
    current_category = "Financial intermediation services, except insurance and pension funding services",
    current_category = "Insurance and pension funding services, except compulsory social security services", 
    current_category = "Services auxiliary to financial intermediation",
    current_category = "Financial services nec",
    current_category = "Research and development services",
    current_category = "Public administration and defence services; compulsory social security services",
    current_category = "Education services",
    current_category = "Health and social work services",
    current_category = "Membership organisation services n.e.c.",
    current_category = "Recreational, cultural and sporting services",
    current_category = "Other services",
    current_category = "Supporting and auxiliary transport services; travel agency services"
  ),
  
  has_scope1_string, AND(NOT(ISBLANK(current_scope1)), NOT(ISNUMBER(current_scope1))),
  
  has_scope2_string, OR(
    AND(NOT(ISBLANK(current_scope2_market)), NOT(ISNUMBER(current_scope2_market))),
    AND(NOT(ISBLANK(current_scope2_location)), NOT(ISNUMBER(current_scope2_location)))
  ),
  
  has_scope3_string, OR(
    AND(NOT(ISBLANK(current_scope3_cat1)), NOT(ISNUMBER(current_scope3_cat1))),
    AND(NOT(ISBLANK(current_scope3_cat2)), NOT(ISNUMBER(current_scope3_cat2))),
    AND(NOT(ISBLANK(current_scope3_cat3)), NOT(ISNUMBER(current_scope3_cat3))),
    AND(NOT(ISBLANK(current_scope3_cat4)), NOT(ISNUMBER(current_scope3_cat4))),
    AND(NOT(ISBLANK(current_scope3_cat5)), NOT(ISNUMBER(current_scope3_cat5))),
    AND(NOT(ISBLANK(current_scope3_cat6)), NOT(ISNUMBER(current_scope3_cat6))),
    AND(NOT(ISBLANK(current_scope3_cat7)), NOT(ISNUMBER(current_scope3_cat7))),
    AND(NOT(ISBLANK(current_scope3_cat8)), NOT(ISNUMBER(current_scope3_cat8)))
  ),
  
  completed_scope1, IF(has_scope1_string, "",
                      IF(ISNUMBER(current_scope1), current_scope1 * 1000, 
                        IF(AND(ISNUMBER(avg_scope1), current_revenue >= 0), avg_scope1 * current_revenue, 0))),
  
  completed_scope2, IF(has_scope2_string, "",
                      IF(ISNUMBER(current_scope2_market), current_scope2_market * 1000,
                        IF(ISNUMBER(current_scope2_location), current_scope2_location * 1000,
                          IF(AND(ISNUMBER(avg_scope2), current_revenue >= 0), avg_scope2 * current_revenue, 0)))),
  
  completed_scope3_cat1, IF(ISNUMBER(current_scope3_cat1), current_scope3_cat1 * 1000, 
                           IF(ISNUMBER(avg_scope3_cat1), 
                             IF(office_based_category, 
                               IF(has_valid_employees, avg_scope3_cat1 * current_employees, ""), 
                               IF(current_revenue >= 0, avg_scope3_cat1 * current_revenue, 0)), 
                             "")),
  
  completed_scope3_cat2, IF(ISNUMBER(current_scope3_cat2), current_scope3_cat2 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat2), current_revenue >= 0), avg_scope3_cat2 * current_revenue, "")),
  
  completed_scope3_cat3, IF(ISNUMBER(current_scope3_cat3), current_scope3_cat3 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat3), current_revenue >= 0), avg_scope3_cat3 * current_revenue, "")),
  
  completed_scope3_cat4, IF(ISNUMBER(current_scope3_cat4), current_scope3_cat4 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat4), current_revenue >= 0), avg_scope3_cat4 * current_revenue, "")),
  
  completed_scope3_cat5, IF(ISNUMBER(current_scope3_cat5), current_scope3_cat5 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat5), has_valid_employees), avg_scope3_cat5 * current_employees, "")),
  
  completed_scope3_cat6, IF(ISNUMBER(current_scope3_cat6), current_scope3_cat6 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat6), has_valid_employees), avg_scope3_cat6 * current_employees, "")),
  
  completed_scope3_cat7, IF(ISNUMBER(current_scope3_cat7), current_scope3_cat7 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat7), has_valid_employees), avg_scope3_cat7 * current_employees, "")),
  
  completed_scope3_cat8, IF(ISNUMBER(current_scope3_cat8), current_scope3_cat8 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat8), current_revenue >= 0), avg_scope3_cat8 * current_revenue, "")),
  
  total_completed_emissions, 
    (IF(ISNUMBER(completed_scope1), completed_scope1, 0)) +
    (IF(ISNUMBER(completed_scope2), completed_scope2, 0)) +
    (IF(ISNUMBER(completed_scope3_cat1), completed_scope3_cat1, 0)) +
    (IF(ISNUMBER(completed_scope3_cat2), completed_scope3_cat2, 0)) +
    (IF(ISNUMBER(completed_scope3_cat3), completed_scope3_cat3, 0)) +
    (IF(ISNUMBER(completed_scope3_cat4), completed_scope3_cat4, 0)) +
    (IF(ISNUMBER(completed_scope3_cat5), completed_scope3_cat5, 0)) +
    (IF(ISNUMBER(completed_scope3_cat6), completed_scope3_cat6, 0)) +
    (IF(ISNUMBER(completed_scope3_cat7), completed_scope3_cat7, 0)) +
    (IF(ISNUMBER(completed_scope3_cat8), completed_scope3_cat8, 0)),
  
  has_sufficient_data, NOT(OR(
    completed_scope3_cat1 = "",
    completed_scope3_cat2 = "",
    completed_scope3_cat3 = "",
    completed_scope3_cat4 = "",
    completed_scope3_cat5 = "",
    completed_scope3_cat6 = "",
    completed_scope3_cat7 = "",
    completed_scope3_cat8 = "",
  )),
  
  IF(AND(ISNUMBER(current_revenue), current_revenue >= 0), 
    IF(has_sufficient_data, 
      IF(current_revenue = 0, 
        "Revenue is zero - cannot calculate per dollar", 
        (total_completed_emissions / current_revenue)), 
      ""), 
    "Invalid Revenue")
)

// BREAKDOWN FORMULA
=LET(
  current_revenue, F10,
  current_employees, H10,
  current_category, AE10,
  current_scope1, J10,
  current_scope2_location, K10,
  current_scope2_market, L10,
  current_scope3_cat1, N10,
  current_scope3_cat2, O10,
  current_scope3_cat3, P10,
  current_scope3_cat4, Q10,
  current_scope3_cat5, R10,
  current_scope3_cat6, S10,
  current_scope3_cat7, T10,
  current_scope3_cat8, U10,
  
  revenue_band, IF(current_revenue <= 50000000, "0-50M", 
                IF(current_revenue <= 250000000, "50M-250M", 
                IF(current_revenue <= 1000000000, "250M-1B", "1B+"))),
  
  employee_band, IF(current_employees <= 100, "1-100", 
                 IF(current_employees <= 500, "101-500", 
                 IF(current_employees <= 2000, "501-2000", "2001+"))),
  
  industry, current_category,
  
  has_valid_employees, AND(NOT(ISBLANK(current_employees)), ISNUMBER(current_employees), current_employees > 0),
  
  specific_match_D, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!D:D, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_D, INDEX(Industry_Averages!D:D, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope1, IF(ISNUMBER(specific_match_D), specific_match_D, IF(ISNUMBER(fallback_match_D), fallback_match_D, "")),
  
  specific_match_E, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!E:E, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_E, INDEX(Industry_Averages!E:E, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope2, IF(ISNUMBER(specific_match_E), specific_match_E, IF(ISNUMBER(fallback_match_E), fallback_match_E, "")),
  
  specific_match_F, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!F:F, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_F, INDEX(Industry_Averages!F:F, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat1, IF(ISNUMBER(specific_match_F), specific_match_F, IF(ISNUMBER(fallback_match_F), fallback_match_F, "")),
  
  specific_match_G, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!G:G, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_G, INDEX(Industry_Averages!G:G, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat2, IF(ISNUMBER(specific_match_G), specific_match_G, IF(ISNUMBER(fallback_match_G), fallback_match_G, "")),
  
  specific_match_H, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!H:H, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_H, INDEX(Industry_Averages!H:H, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat3, IF(ISNUMBER(specific_match_H), specific_match_H, IF(ISNUMBER(fallback_match_H), fallback_match_H, "")),
  
  specific_match_I, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!I:I, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_I, INDEX(Industry_Averages!I:I, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat4, IF(ISNUMBER(specific_match_I), specific_match_I, IF(ISNUMBER(fallback_match_I), fallback_match_I, "")),
  
  specific_match_J, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!J:J, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_J, INDEX(Industry_Averages!J:J, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat5, IF(ISNUMBER(specific_match_J), specific_match_J, IF(ISNUMBER(fallback_match_J), fallback_match_J, "")),
  
  specific_match_K, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!K:K, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_K, INDEX(Industry_Averages!K:K, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat6, IF(ISNUMBER(specific_match_K), specific_match_K, IF(ISNUMBER(fallback_match_K), fallback_match_K, "")),
  
  specific_match_L, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!L:L, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_L, INDEX(Industry_Averages!L:L, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat7, IF(ISNUMBER(specific_match_L), specific_match_L, IF(ISNUMBER(fallback_match_L), fallback_match_L, "")),
  
  specific_match_M, IF(industry = "Financial intermediation services, except insurance and pension funding services", "", INDEX(Industry_Averages!M:M, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = revenue_band) * (Industry_Averages!C:C = employee_band), 0))),
  fallback_match_M, INDEX(Industry_Averages!M:M, MATCH(1, (Industry_Averages!A:A = industry) * (Industry_Averages!B:B = "ALL_BANDS") * (Industry_Averages!C:C = "ALL_BANDS"), 0)),
  avg_scope3_cat8, IF(ISNUMBER(specific_match_M), specific_match_M, IF(ISNUMBER(fallback_match_M), fallback_match_M, "")),
  
  office_based_category, OR(
    current_category = "Financial intermediation services, except insurance and pension funding services",
    current_category = "Insurance and pension funding services, except compulsory social security services", 
    current_category = "Services auxiliary to financial intermediation",
    current_category = "Financial services nec",
    current_category = "Research and development services",
    current_category = "Public administration and defence services; compulsory social security services",
    current_category = "Education services",
    current_category = "Health and social work services",
    current_category = "Membership organisation services n.e.c.",
    current_category = "Recreational, cultural and sporting services",
    current_category = "Other services",
    current_category = "Supporting and auxiliary transport services; travel agency services"
  ),
  
  has_scope1_string, AND(NOT(ISBLANK(current_scope1)), NOT(ISNUMBER(current_scope1))),
  
  has_scope2_string, OR(
    AND(NOT(ISBLANK(current_scope2_market)), NOT(ISNUMBER(current_scope2_market))),
    AND(NOT(ISBLANK(current_scope2_location)), NOT(ISNUMBER(current_scope2_location)))
  ),
  
  has_scope3_string, OR(
    AND(NOT(ISBLANK(current_scope3_cat1)), NOT(ISNUMBER(current_scope3_cat1))),
    AND(NOT(ISBLANK(current_scope3_cat2)), NOT(ISNUMBER(current_scope3_cat2))),
    AND(NOT(ISBLANK(current_scope3_cat3)), NOT(ISNUMBER(current_scope3_cat3))),
    AND(NOT(ISBLANK(current_scope3_cat4)), NOT(ISNUMBER(current_scope3_cat4))),
    AND(NOT(ISBLANK(current_scope3_cat5)), NOT(ISNUMBER(current_scope3_cat5))),
    AND(NOT(ISBLANK(current_scope3_cat6)), NOT(ISNUMBER(current_scope3_cat6))),
    AND(NOT(ISBLANK(current_scope3_cat7)), NOT(ISNUMBER(current_scope3_cat7))),
    AND(NOT(ISBLANK(current_scope3_cat8)), NOT(ISNUMBER(current_scope3_cat8)))
  ),
  
  completed_scope1, IF(has_scope1_string, "",
                      IF(ISNUMBER(current_scope1), current_scope1 * 1000, 
                        IF(AND(ISNUMBER(avg_scope1), current_revenue >= 0), avg_scope1 * current_revenue, 0))),
  
  completed_scope2, IF(has_scope2_string, "",
                      IF(ISNUMBER(current_scope2_market), current_scope2_market * 1000,
                        IF(ISNUMBER(current_scope2_location), current_scope2_location * 1000,
                          IF(AND(ISNUMBER(avg_scope2), current_revenue >= 0), avg_scope2 * current_revenue, 0)))),
  
  completed_scope3_cat1, IF(ISNUMBER(current_scope3_cat1), current_scope3_cat1 * 1000, 
                           IF(ISNUMBER(avg_scope3_cat1), 
                             IF(office_based_category, 
                               IF(has_valid_employees, avg_scope3_cat1 * current_employees, ""), 
                               IF(current_revenue >= 0, avg_scope3_cat1 * current_revenue, 0)), 
                             "")),
  
  completed_scope3_cat2, IF(ISNUMBER(current_scope3_cat2), current_scope3_cat2 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat2), current_revenue >= 0), avg_scope3_cat2 * current_revenue, "")),
  
  completed_scope3_cat3, IF(ISNUMBER(current_scope3_cat3), current_scope3_cat3 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat3), current_revenue >= 0), avg_scope3_cat3 * current_revenue, "")),
  
  completed_scope3_cat4, IF(ISNUMBER(current_scope3_cat4), current_scope3_cat4 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat4), current_revenue >= 0), avg_scope3_cat4 * current_revenue, "")),
  
  completed_scope3_cat5, IF(ISNUMBER(current_scope3_cat5), current_scope3_cat5 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat5), has_valid_employees), avg_scope3_cat5 * current_employees, "")),
  
  completed_scope3_cat6, IF(ISNUMBER(current_scope3_cat6), current_scope3_cat6 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat6), has_valid_employees), avg_scope3_cat6 * current_employees, "")),
  
  completed_scope3_cat7, IF(ISNUMBER(current_scope3_cat7), current_scope3_cat7 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat7), has_valid_employees), avg_scope3_cat7 * current_employees, "")),
  
  completed_scope3_cat8, IF(ISNUMBER(current_scope3_cat8), current_scope3_cat8 * 1000, 
                           IF(AND(ISNUMBER(avg_scope3_cat8), current_revenue >= 0), avg_scope3_cat8 * current_revenue, "")),
  
  scope1_can_estimate, AND(
    ISNUMBER(avg_scope1),
    ISNUMBER(current_revenue), current_revenue >= 0,
    NOT(has_scope1_string),
    OR(ISBLANK(current_scope1), NOT(ISNUMBER(current_scope1)))
  ),
  
  scope2_original, IF(ISNUMBER(current_scope2_market), current_scope2_market, 
                      IF(ISNUMBER(current_scope2_location), current_scope2_location, "")),
  scope2_can_estimate, AND(
    ISNUMBER(avg_scope2),
    ISNUMBER(current_revenue), current_revenue >= 0,
    NOT(has_scope2_string),
    OR(ISBLANK(scope2_original), NOT(ISNUMBER(scope2_original)))
  ),
  
  scope3_cat1_can_estimate, OR(
    AND(office_based_category, has_valid_employees, ISNUMBER(avg_scope3_cat1)),
    AND(NOT(office_based_category), ISNUMBER(avg_scope3_cat1), ISNUMBER(current_revenue), current_revenue >= 0)
  ),
  
  scope3_cat2_can_estimate, AND(ISNUMBER(avg_scope3_cat2), ISNUMBER(current_revenue), current_revenue >= 0),
  scope3_cat3_can_estimate, AND(ISNUMBER(avg_scope3_cat3), ISNUMBER(current_revenue), current_revenue >= 0),
  scope3_cat4_can_estimate, AND(ISNUMBER(avg_scope3_cat4), ISNUMBER(current_revenue), current_revenue >= 0),
  scope3_cat5_can_estimate, AND(ISNUMBER(avg_scope3_cat5), has_valid_employees),
  scope3_cat6_can_estimate, AND(ISNUMBER(avg_scope3_cat6), has_valid_employees),
  scope3_cat7_can_estimate, AND(ISNUMBER(avg_scope3_cat7), has_valid_employees),
  scope3_cat8_can_estimate, AND(ISNUMBER(avg_scope3_cat8), ISNUMBER(current_revenue), current_revenue >= 0),
  
  scope1_source, IF(AND(NOT(ISBLANK(current_scope1)), ISNUMBER(current_scope1)), 
                    "[Actual]", 
                    IF(scope1_can_estimate, "[Estimated]", "[Missing]")),
  
  scope2_source, IF(AND(NOT(ISBLANK(scope2_original)), ISNUMBER(scope2_original)), 
                    "[Actual]", 
                    IF(scope2_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat1_source, IF(AND(NOT(ISBLANK(current_scope3_cat1)), ISNUMBER(current_scope3_cat1)), 
                         "[Actual]", 
                         IF(scope3_cat1_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat2_source, IF(AND(NOT(ISBLANK(current_scope3_cat2)), ISNUMBER(current_scope3_cat2)), 
                         "[Actual]", 
                         IF(scope3_cat2_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat3_source, IF(AND(NOT(ISBLANK(current_scope3_cat3)), ISNUMBER(current_scope3_cat3)), 
                         "[Actual]", 
                         IF(scope3_cat3_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat4_source, IF(AND(NOT(ISBLANK(current_scope3_cat4)), ISNUMBER(current_scope3_cat4)), 
                         "[Actual]", 
                         IF(scope3_cat4_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat5_source, IF(AND(NOT(ISBLANK(current_scope3_cat5)), ISNUMBER(current_scope3_cat5)), 
                         "[Actual]", 
                         IF(scope3_cat5_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat6_source, IF(AND(NOT(ISBLANK(current_scope3_cat6)), ISNUMBER(current_scope3_cat6)), 
                         "[Actual]", 
                         IF(scope3_cat6_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat7_source, IF(AND(NOT(ISBLANK(current_scope3_cat7)), ISNUMBER(current_scope3_cat7)), 
                         "[Actual]", 
                         IF(scope3_cat7_can_estimate, "[Estimated]", "[Missing]")),
  
  scope3_cat8_source, IF(AND(NOT(ISBLANK(current_scope3_cat8)), ISNUMBER(current_scope3_cat8)), 
                         "[Actual]", 
                         IF(scope3_cat8_can_estimate, "[Estimated]", "[Missing]")),
  
  CONCATENATE(
    "S1: ", IF(ISNUMBER(completed_scope1), ROUND(completed_scope1, 2), "N/A"), 
    " ", scope1_source, " | ",
    "S2: ", IF(ISNUMBER(completed_scope2), ROUND(completed_scope2, 2), "N/A"), 
    " ", scope2_source, " | ",
    "S3-1: ", IF(ISNUMBER(completed_scope3_cat1), ROUND(completed_scope3_cat1, 2), "N/A"), 
    " ", scope3_cat1_source, " | ",
    "S3-2: ", IF(ISNUMBER(completed_scope3_cat2), ROUND(completed_scope3_cat2, 2), "N/A"), 
    " ", scope3_cat2_source, " | ",
    "S3-3: ", IF(ISNUMBER(completed_scope3_cat3), ROUND(completed_scope3_cat3, 2), "N/A"), 
    " ", scope3_cat3_source, " | ",
    "S3-4: ", IF(ISNUMBER(completed_scope3_cat4), ROUND(completed_scope3_cat4, 2), "N/A"), 
    " ", scope3_cat4_source, " | ",
    "S3-5: ", IF(ISNUMBER(completed_scope3_cat5), ROUND(completed_scope3_cat5, 2), "N/A"), 
    " ", scope3_cat5_source, " | ",
    "S3-6: ", IF(ISNUMBER(completed_scope3_cat6), ROUND(completed_scope3_cat6, 2), "N/A"), 
    " ", scope3_cat6_source, " | ",
    "S3-7: ", IF(ISNUMBER(completed_scope3_cat7), ROUND(completed_scope3_cat7, 2), "N/A"), 
    " ", scope3_cat7_source, " | ",
    "S3-8: ", IF(ISNUMBER(completed_scope3_cat8), ROUND(completed_scope3_cat8, 2), "N/A"), 
    " ", scope3_cat8_source
  )
)